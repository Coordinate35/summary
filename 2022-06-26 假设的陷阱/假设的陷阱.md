| 作者         | 版本号 | 时间      |
| :----------- | :----- | :-------- |
| Coordinate35 | v1.0.0 | 2022-06-26 |

# 假设的陷阱

写这篇文章是因为近半年遇到了一些故障。不管是排查的过程还是故障排查的结果，都表示这“假设”这一工具的强大，以及假设之下处处是陷阱。

在进行一个项目的时候，我们要完成的一个重要过程就是做设计。设计的是一个回答为什么的过程：
* 为什么是这样？
* 为什么这样做能够达成我们的目标

回答为什么这样的问题，我们通常都是构建[逻辑链](../2021-09-21%20关于项目管理/关于项目管理.md)的方式解决的。即用这样的句式：“因为...,所以...”。对于每一个因为，都可以再拆成"因为...,所以..."。所以，逻辑是一层一层的。设计就是每一层每一层构建完成的逻辑闭包。第二个因为就是第一个因为的假设。

比如：目的是每周都要从北京去西安办事。在正常情况下，我们可以说：因为买到了明天的火车票，所以明天坐火车就能去到西安办事。此时逻辑已经看起来完整了。但是你还可以继续问：为什么买了火车票就能到西安呢？因为火车几乎是不会事故的。在这里，出事故就是第一层逻辑的假设。

所以顶层逻辑能否成立，依赖于底层的假设是否坚固。但可能有人会觉得，为什么可以一直问下去，越到底层就越难回答么，这样还能判断假设是否坚固嘛？答案是可能的，工程的最终目的不是解释清楚每一个原理，而是能达到目标就行，所以我们可以根据我们的经验数据，来判断底层逻辑的可靠性。比如高火车的事故率。

由此看来，假设确实能帮助我们很大程度简化问题。

但是问题远远没有这么简单，很多时候我们往往都不知道自己依赖了哪些假设。比如买了火车票就能到西安，原因是：
1. 这个结论底下的依赖假设非常多，比如：北京没有发生高风险疫情.....
2. 火车事故率这个数值也不是随着时间推移一成不变的，比如火车某日得到了革新，刚开始投入使用，那么事故率可能就会提高。


所以我们在最终实施的时候，一定需要：
1. 尽可能的理清楚我们的逻辑都依赖那些假设，并选择那些坚固的假设进行依赖
2. 并长期对这些假设进行监控，检测是否被打破，实施做好预警感知
3. 当处理问题没有头绪的时候，梳理是否还存在没有考虑到的假设，是否有被打破


补充假设被打破的例子：

例子1:

微服务通信时。通常情况下，我们使用日志模型定位超时类问题。比如 A 服务调用 B 服务，A 调 B 超时了。通常，我们只要通过看 B 的日志，确实耗时很长，就可以认为 B 服务有。 但是从 B 的日志来看，这个请求很快就被处理完返回了。这个时候僵住了，该怎么分析呢？

此时日志模型已经不够用了，得考虑日志模型依赖了哪些假设：
1. A 服务和 B 服务的计时系统都是准的，日志时间也是准的。
2. 内核没出问题，比如 A 和 B 在读写内核协议栈的时候，网络包都被及时收发出去了
3. A 和 B 之间网络没问题
4. ...

最终定位到是：A 服务是使用进程内的时间缓存进行打日志的，由于线程事件循环卡顿，导致时间缓存更新不及时，日志时间打印偏短。


例子2:

线上的  Nginx  程序一直没有变更。但是某一天运维同学发现它抖动越来越剧烈，并且都伴随着一个动态更新后段实例列表的操作。排查后发现是当初模块的设计是假设后端的实例总数在千级别的数量级下是正常工作的。但是随着业务上云，后端实例数迅速增长到了万级别，假设被打破，触达了性能瓶颈。
